import Crypto
from Crypto.PublicKey import RSA
from Crypto.Cipher import AES
from Crypto import Random
import ast
import datetime

AES_IV = 'IV13579IV2468IV1'     # 128 Bit Initialisierungsvektor

#decrypted code below

f = open('KeyServer/LogKeys/1712017.pem', 'rb')
message = f.read()
print "AES Key:"
print message

#encryptedKey = message
encryptedKey = 'C\x10\xe1r[x@@\xbc\x85\x01\xf5\x991\x1e7}\xb8\xb2\xe6\xbf\xe2Q\x10.\x0cD\xca)\x1d\x93\\\x8e:\x14\x99Y\'\x9d\xa8\xd7\xddL\x13\nkb\x02\xec1o S\x18\x8bo\x9cX\x15T\x08\x8e\xbcDn\xebM\xfd\x12\x8d\x9c\xea_\x93\xd4RC\xce\xbe\x04`T\x10N\xaf\xab\xc8\xa1\xa3\xe8\xeb\xe1b\xb0M\x87\xdc\xdf\xfe\xf9:\x1e)\xf7\xd5\xc4\xc5U\xb5\x85\x06\'\xf0\xc0\xc8\x87c\xe8\x8f\xb9\x03f\xdb\x94\xde\xc9.\x9b\x19]T\xf097W\xcd\x0f\x873\xb5E\xbd,\x8b\xbaN\x96\x93v\x01;\xc1\xb6u\xec\xcau\xc4\xf7\xcb#\xfc\x91\xd6]\x90\xb6\x11l\xe3|\xc1\xcd\xfc\xb6\x04\x86\xffz\x12\xfb-K\xb1\x8b4W\xa5\xe0\x16\xcenLs\xe45\xef\x07\xd0\xdd\xf1\x08\xbf|w\xc8\xaf\xd89\'t\x00w\xb7\xb1\x07\xf6&\x84\xcfv1\x86%\xed\x92%\xc9\xf6\t\xe9\xca\xc3\xba\xc1H#\xab\xa2Q\xd3\x8b`\t\xa3"\xf1*\x83\xceF\xbc7\xc0,\xee'

f = open('masterKey/privateMasterKey.pem','rb')
key = RSA.importKey(f.read())
decrypted = key.decrypt(str(encryptedKey))
#decrypted = key.decrypt(ast.literal_eval(str(message)))

print decrypted


 #Decryption AES
decryption_suite = AES.new(decrypted, AES.MODE_CBC, AES_IV)
f = open('Log/17120179302196153.txt', 'r')
messageLog = f.read()
plain_text = decryption_suite.decrypt(messageLog)

print "LogMessage:"
print plain_text
